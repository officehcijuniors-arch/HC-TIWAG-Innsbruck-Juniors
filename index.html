<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<title>HC TIWAG Innsbruck Juniors - Infosäule (Stabile Version)</title>

<!-- ======================================================
     CSS – Layout, Farben und Übergänge
     ====================================================== -->
<style>
body {
  margin: 0;
  overflow: hidden;
  font-family: "Areno Serif", serif;
  background: #000;
  color: #fff;
}

/* Jede Seite wird überlagert, nur die aktive sichtbar */
.page {
  position: absolute;
  inset: 0;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.8s ease;
}
.page.active {
  opacity: 1;
  pointer-events: all;
  z-index: 1;
}

/* iFrames und Videos füllen den Container */
iframe, video {
  width: 100%;
  height: 100%;
  border: 0;
  border-radius: 10px;
}

/* Videos skalieren, ohne zu schneiden */
.video-page video {
  object-fit: contain;
}

/* Signatur unten rechts */
.signature {
  position: fixed;
  bottom: 8px;
  right: 12px;
  font-size: 0.8em;
  color: rgba(255,255,255,0.4);
  pointer-events: none;
  z-index: 9999;
}
</style>
</head>
<body>

<!-- ======================================================
     Seitenstruktur
     ====================================================== -->
<section class="page page-1 active">
  <iframe data-src="Infopoint.html"></iframe>
</section>

<section class="page page-2">
  <iframe data-src="KALENDER.html"></iframe>
</section>

<section class="page page-3">
  <iframe data-src="ORG.html"></iframe>
</section>

<section class="page video-page page-4">
  <video autoplay loop muted playsinline preload="none">
    <source data-src="Fotoshop.mp4" type="video/mp4">
  </video>
</section>

<section class="page video-page page-5">
  <video autoplay loop muted playsinline preload="none">
    <source data-src="Fanshop.mp4" type="video/mp4">
  </video>
</section>

<section class="page video-page page-6">
  <video autoplay loop muted playsinline preload="none">
    <source data-src="HCINWSPPräs.mp4" type="video/mp4">
  </video>
</section>

<section class="page page-7">
  <iframe data-src="spielerfotos.html"></iframe>
</section>

<section class="page page-8"></section>
<section class="page page-9"></section>

<footer class="signature">MS</footer>

<!-- ======================================================
     JavaScript – Rotation & Fehlerbehandlung
     ====================================================== -->
<script>
window.addEventListener('DOMContentLoaded', async () => {
  const pages = document.querySelectorAll('.page');
  let current = 0;
  let settings;

  // JSON-Datei mit Einstellungen laden
  const settingsUrl = 'https://raw.githubusercontent.com/officehcijuniors-arch/HC-TIWAG-Innsbruck-Juniors/main/settings.json';
  try {
    const res = await fetch(settingsUrl, {cache:"no-store"});
    settings = await res.json();
  } catch(err) {
    console.warn("⚠️ Einstellungen konnten nicht geladen werden, Standardwerte werden genutzt.");
    settings = {
      pages: {1:{enabled:true,duration:10},2:{enabled:true,duration:20},3:{enabled:true,duration:15},7:{enabled:true,duration:55}},
      reload: 60,
      options: {lazyVideoLoad:true,lazyIframeLoad:true}
    };
  }

  // --- Aktive Seiten
  function getActivePages() {
    const arr = [];
    for (let i = 1; i <= 9; i++) if(settings.pages[i] && settings.pages[i].enabled) arr.push(i-1);
    return arr;
  }

  // --- Dauer pro Seite
  function getDurations() {
    const d = {};
    for (let i = 1; i <= 9; i++) if(settings.pages[i]) d[i-1] = settings.pages[i].duration*1000;
    return d;
  }

  // --- iFrame Laden mit Timeout
  function loadIframe(page) {
    const iframe = page.querySelector('iframe');
    if(!iframe || iframe.src) return;
    if(iframe.dataset.src){
      try{
        iframe.src = iframe.dataset.src;
        setTimeout(() => {
          if(!iframe.contentWindow){
            console.warn('⚠️ iFrame konnte nicht geladen werden, überspringe.');
            iframe.remove();
          }
        },8000);
      }catch(e){iframe.remove();}
    }
  }

  // --- Video Laden mit Timeout
  function loadVideo(page){
    const video = page.querySelector('video');
    if(!video || video.dataset.loaded) return;
    const source = video.querySelector('source');
    if(source && source.dataset.src){
      source.src = source.dataset.src;
      video.load();
      video.dataset.loaded = true;
      let played = false;
      video.oncanplay = () => played = true;
      setTimeout(()=>{if(!played){console.warn('⚠️ Video nicht geladen, überspringe');video.remove();}},8000);
    }
  }

  // --- Seite anzeigen
  function showPage(index){
    pages.forEach((p,i)=>p.classList.toggle('active',i===index));
    const page = pages[index];
    if(page.classList.contains('video-page')) loadVideo(page);
    else loadIframe(page);
  }

  // --- Rotation
  function rotateToNext(){
    const active = getActivePages();
    const durations = getDurations();
    if(active.length===0) return;
    let pos = active.indexOf(current);
    if(pos===-1) pos=0;
    current = active[(pos+1)%active.length];
    showPage(current);
    setTimeout(rotateToNext,durations[current]||8000);
  }

  // --- Start
  const activePages = getActivePages();
  current = activePages.length>0 ? activePages[0] : 0;
  showPage(current);
  rotateToNext();

  // --- Auto-Reload alle x Minuten
  if(settings.reload && settings.reload>0){
    setInterval(()=>location.reload(), settings.reload*60*1000);
  }
});
</script>
</body>
</html>
