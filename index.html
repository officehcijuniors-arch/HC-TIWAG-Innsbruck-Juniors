<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8"> <!-- Zeichencodierung für Umlaute -->
<title>HC TIWAG Innsbruck Juniors - Infosäule (Stabile Version)</title>

<!-- ======================================================
     CSS – Schrift, Layout, Farben, Übergänge
     ====================================================== -->
<style>
/* ========================================
   1) LOKALE SCHRIFTART ARENO SERIF
   ======================================== */
@font-face {
    font-family: "Areno Serif";
    src: url("fonts/areno-serif-webfont.woff2") format("woff2"),
         url("fonts/areno-serif-webfont.woff") format("woff"),
         url("fonts/Areno-Serif.otf") format("opentype");
    font-weight: normal;
    font-style: normal;
}

@font-face {
    font-family: "Areno Serif";
    src: url("fonts/areno-serif-webfont.woff2") format("woff2"),
         url("fonts/areno-serif-webfont.woff") format("woff"),
         url("fonts/Areno-Serif.otf") format("opentype");
    font-weight: 800; /* fette Schrift */
    font-style: normal;
}

/* ========================================
   2) GRUNDEINSTELLUNGEN FÜR BODY
   ======================================== */
body {
  margin: 0; /* kein Abstand außen */
  overflow: hidden; /* keine Scrollbalken */
  font-family: "Areno Serif", serif; /* lokale Schrift */
  background: #000; /* schwarzer Hintergrund */
  color: #fff; /* weiße Schrift */
}

/* ========================================
   3) SEITENSTRUKTUR – Jede Seite als Overlay
   ======================================== */
.page {
  position: absolute; /* übereinander stapeln */
  inset: 0;           /* oben, rechts, unten, links = 0 */
  opacity: 0;         /* unsichtbar standardmäßig */
  pointer-events: none; /* nicht klickbar, solange nicht aktiv */
  transition: opacity 0.8s ease; /* sanfte Einblendung */
}

/* Aktivierte Seite sichtbar machen */
.page.active {
  opacity: 1;
  pointer-events: all; /* jetzt klickbar */
  z-index: 1;          /* oben */
}

/* ========================================
   4) iFrames & Videos füllen Container
   ======================================== */
iframe, video {
  width: 100%;   /* volle Breite */
  height: 100%;  /* volle Höhe */
  border: 0;     /* keine Rahmen */
  border-radius: 10px; /* leicht abgerundete Ecken */
}

/* Videos skalieren korrekt ohne Zuschneiden */
.video-page video {
  object-fit: contain; /* Bild bleibt komplett sichtbar */
}

/* ========================================
   5) SIGNATUR (unten rechts)
   ======================================== */
.signature {
  position: fixed; /* bleibt immer sichtbar */
  bottom: 8px;     /* Abstand vom unteren Rand */
  right: 12px;     /* Abstand vom rechten Rand */
  font-size: 0.8em;
  color: rgba(255,255,255,0.4); /* hell, aber transparent */
  pointer-events: none; /* stört nicht bei Klicks */
  z-index: 9999;    /* immer ganz oben */
}
</style>
</head>
<body>

<!-- ======================================================
     6) SEITENINHALT
     Jede Seite wird als Overlay geladen
     ====================================================== -->
<section class="page page-1 active">
  <iframe data-src="Infopoint.html"></iframe> <!-- Infopoint -->
</section>

<section class="page page-2">
  <iframe data-src="KALENDER.html"></iframe> <!-- Kalender -->
</section>

<section class="page page-3">
  <iframe data-src="ORG.html"></iframe> <!-- ORG-Bild -->
</section>

<section class="page video-page page-4">
  <video autoplay loop muted playsinline preload="none">
    <source data-src="Fotoshop.mp4" type="video/mp4"> <!-- Fanshop-Video -->
  </video>
</section>

<section class="page video-page page-5">
  <video autoplay loop muted playsinline preload="none">
    <source data-src="Fanshop.mp4" type="video/mp4"> <!-- Fanshop-Video -->
  </video>
</section>

<section class="page video-page page-6">
  <video autoplay loop muted playsinline preload="none">
    <source data-src="HCINWSPPräs.mp4" type="video/mp4"> <!-- HCIN Präsentation -->
  </video>
</section>

<section class="page page-7">
  <iframe data-src="spielerfotos.html"></iframe> <!-- Spielerfotos -->
</section>

<section class="page page-8"></section> <!-- Platzhalter für zukünftige Seiten -->
<section class="page page-9"></section> <!-- Platzhalter -->

<footer class="signature">MS</footer> <!-- Signatur unten rechts -->

<!-- ======================================================
     7) JAVASCRIPT – Rotation & Lade-Logik
     ====================================================== -->
<script>
window.addEventListener('DOMContentLoaded', async () => {
  const pages = document.querySelectorAll('.page'); // Alle Seiten
  let current = 0; // Aktuelle Seite
  let settings;

  // --- JSON-Datei mit Einstellungen laden ---
  const settingsUrl = 'https://raw.githubusercontent.com/officehcijuniors-arch/HC-TIWAG-Innsbruck-Juniors/main/settings.json';
  try {
    const res = await fetch(settingsUrl, {cache:"no-store"}); // immer neu laden
    settings = await res.json(); // JSON auswerten
  } catch(err) {
    console.warn("⚠️ Einstellungen konnten nicht geladen werden, Standardwerte werden genutzt.");
    settings = { // Fallback-Werte
      pages: {1:{enabled:true,duration:10},2:{enabled:true,duration:20},3:{enabled:true,duration:15},7:{enabled:true,duration:55}},
      reload: 60,
      options: {lazyVideoLoad:true,lazyIframeLoad:true}
    };
  }

  // --- Aktive Seiten ermitteln ---
  function getActivePages() {
    const arr = [];
    for (let i = 1; i <= 9; i++)
      if(settings.pages[i] && settings.pages[i].enabled) arr.push(i-1);
    return arr;
  }

  // --- Dauer pro Seite in ms ---
  function getDurations() {
    const d = {};
    for (let i = 1; i <= 9; i++)
      if(settings.pages[i]) d[i-1] = settings.pages[i].duration*1000;
    return d;
  }

  // --- iFrame laden ---
  function loadIframe(page) {
    const iframe = page.querySelector('iframe');
    if(!iframe || iframe.src) return; // schon geladen?
    if(iframe.dataset.src){
      try{
        iframe.src = iframe.dataset.src; // iFrame Quelle setzen
        setTimeout(() => {
          if(!iframe.contentWindow){
            console.warn('⚠️ iFrame konnte nicht geladen werden, überspringe.');
            iframe.remove();
          }
        },8000); // Timeout nach 8s
      }catch(e){iframe.remove();}
    }
  }

  // --- Video laden ---
  function loadVideo(page){
    const video = page.querySelector('video');
    if(!video || video.dataset.loaded) return; // schon geladen?
    const source = video.querySelector('source');
    if(source && source.dataset.src){
      source.src = source.dataset.src; // Videoquelle setzen
      video.load(); // Video laden
      video.dataset.loaded = true;
      let played = false;
      video.oncanplay = () => played = true; // prüfen ob spielbar
      setTimeout(()=>{if(!played){
        console.warn('⚠️ Video nicht geladen, überspringe');
        video.remove();
      }},8000);
    }
  }

  // --- Seite anzeigen ---
  function showPage(index){
    pages.forEach((p,i)=>p.classList.toggle('active',i===index));
    const page = pages[index];
    if(page.classList.contains('video-page')) loadVideo(page);
    else loadIframe(page);
  }

  // --- Rotation zur nächsten Seite ---
  function rotateToNext(){
    const active = getActivePages();
    const durations = getDurations();
    if(active.length===0) return;
    let pos = active.indexOf(current);
    if(pos===-1) pos=0;
    current = active[(pos+1)%active.length]; // zyklisch
    showPage(current);
    setTimeout(rotateToNext,durations[current]||8000);
  }

  // --- Start ---
  const activePages = getActivePages();
  current = activePages.length>0 ? activePages[0] : 0;
  showPage(current);
  rotateToNext();

  // --- Automatischer Reload alle x Minuten ---
  if(settings.reload && settings.reload>0){
    setInterval(()=>location.reload(), settings.reload*60*1000);
  }
});
</script>
</body>
</html>
